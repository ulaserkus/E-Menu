<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050;">
  <!-- Chat Toggle Button -->
  <button 
    class="btn btn-dark rounded-circle d-flex align-items-center justify-content-center shadow" 
    style="width: 30px; height: 30px;" 
    (click)="isChatOpen = !isChatOpen">
    <i [class]="isChatOpen ? 'bi bi-x-lg' : 'bi bi-chat-dots-fill'"></i>
  </button>

  <!-- Chat Window -->
  <div 
    class="card shadow mt-2" 
    [class.d-none]="!isChatOpen" 
    style="width: 350px;">
    <!-- Chat Header -->
    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Chat Bot</h5>
      <span class="badge rounded-pill" 
            [ngClass]="isConnected ? 'bg-success' : 'bg-danger'">
        {{ isConnected ? 'Bağlı' : 'Bağlantı Kesildi' }}
      </span>
    </div>

    <!-- Chat Messages -->
    <div class="card-body p-3" style="height: 400px; overflow-y: auto;">
      <div *ngFor="let message of messages" class="mb-3">
        <div [class]="message.sender === 'user' ? 'd-flex justify-content-end' : 'd-flex justify-content-start'">
          <div 
            class="p-3 rounded-3 shadow-sm" 
            [ngClass]="message.sender === 'user' ? 'bg-primary text-white' : 'bg-light'">
            {{ message.text }}
            <div 
              class="small text-opacity-75 mt-2" 
              [ngClass]="message.sender === 'user' ? 'text-white-50' : 'text-muted'">
              {{ message.timestamp | date:'HH:mm' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div *ngIf="isTyping" class="d-flex justify-content-start">
        <div class="bg-light p-3 rounded-3 shadow-sm">
          <div class="typing-indicator d-flex">
            <span class="typing-dot bg-secondary rounded-circle me-1" 
                  style="width: 8px; height: 8px;"></span>
            <span class="typing-dot bg-secondary rounded-circle me-1" 
                  style="width: 8px; height: 8px;"></span>
            <span class="typing-dot bg-secondary rounded-circle" 
                  style="width: 8px; height: 8px;"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="card-footer bg-white p-3">
      <div class="input-group">
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="userMessage" 
          placeholder="Mesajınızı yazın..." 
          [disabled]="!isConnected"
          (keyup.enter)="sendMessage()">
        <button 
          class="btn btn-dark" 
          type="button" 
          [disabled]="!isConnected || !userMessage.trim()" 
          (click)="sendMessage()">
          <i class="bi bi-send"></i> Gönder
        </button>
      </div>
    </div>
  </div>
</div>